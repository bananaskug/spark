<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spark - Account</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" />
<link rel="icon" href="https://raw.githubusercontent.com/bananaskug/sparkvids/main/sparklogo.png">
<style>
  body { background:#000; color:#fff; font-family:Arial,sans-serif; margin:0; padding:20px; }
  .form { max-width:400px; margin:80px auto; padding:20px; background:#111; border-radius:8px; }
  input, button { width:100%; margin:10px 0; padding:10px; border-radius:6px; border:none; }
  input { background:#222; color:#fff; }
  button { background:#007aff; color:#fff; cursor:pointer; }
  #logout { background:#ff3b30; display:none; }
  .nav-icon { cursor:pointer; font-size:28px; color: #fff; text-decoration: none;}
  nav { display:flex; justify-content:space-around; padding:10px; background:#111; border-bottom:1px solid #333; position:fixed; top:0; left:0; right:0; z-index:10; }
  nav a { color:#fff; text-decoration:none; font-size:28px; cursor:pointer; }

  /* Moderator button */
  #mod-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: url('https://raw.githubusercontent.com/bananaskug/sparkvids/refs/heads/main/darkmoderator.png') no-repeat center/contain;
    border: none;
    cursor: pointer;
    display: none;
    z-index: 50;
  }
</style>
</head>
<body>
<nav>
    <a href="index.html" class="nav-icon material-symbols-rounded">home</a>
    <a href="upload.html" class="nav-icon material-symbols-rounded">add_circle</a>
    <a href="account.html" class="nav-icon material-symbols-rounded">account_circle</a>
</nav>

<div class="form" id="auth-section">
  <h2>Account</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="signup">Sign Up</button>
  <button id="login">Login</button>
</div>
<button id="logout">Logout</button>
<p id="user-info"></p>

<!-- Moderator Button -->
<button id="mod-btn" title="Moderator Panel"></button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDrhxEA1JT513op42cJHnoWx7nvlpmcMwE",
  authDomain: "spark-e4543.firebaseapp.com",
  projectId: "spark-e4543",
  storageBucket: "spark-e4543.firebasestorage.app",
  messagingSenderId: "26655443387",
  appId: "1:26655443387:web:338dc235c607650a389c9e"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const username = document.getElementById("username");
const email = document.getElementById("email");
const password = document.getElementById("password");
const signupBtn = document.getElementById("signup");
const loginBtn = document.getElementById("login");
const logoutBtn = document.getElementById("logout");
const authSection = document.getElementById("auth-section");
const userInfo = document.getElementById("user-info");
const modBtn = document.getElementById("mod-btn");

// Sign Up
signupBtn.onclick = async () => {
  if(!username.value) return alert("Enter a username!");
  try {
    const userCred = await createUserWithEmailAndPassword(auth, email.value, password.value);
    await updateProfile(userCred.user, { displayName: username.value });
    await setDoc(doc(db, "users", userCred.user.uid), {
      email: email.value,
      username: username.value,
      createdAt: new Date()
    });
    alert("Signed up as " + username.value);
  } catch(err) {
    alert(err.message);
  }
};

// Login
loginBtn.onclick = () => {
  signInWithEmailAndPassword(auth, email.value, password.value).catch(err => alert(err.message));
};

// Logout
logoutBtn.onclick = () => signOut(auth);

// Auth state listener
onAuthStateChanged(auth, user => {
  if(user) {
    authSection.style.display = "none";
    logoutBtn.style.display = "block";
    userInfo.textContent = "Logged in as " + (user.displayName || user.email);

    // Show moderator button if email matches
    if(user.email === "theguahh@gmail.com", "gwishyman@gmail.com", "taj_williams@outlook.com"){
      modBtn.style.display = "block";
      modBtn.onclick = () => {
        // Add your moderator panel action here
        window.location.href = "dashboard.html";
      };
    } else {
      modBtn.style.display = "none";
    }

  } else {
    authSection.style.display = "block";
    logoutBtn.style.display = "none";
    userInfo.textContent = "Not logged in";
    modBtn.style.display = "none";
  }
});
</script>
</body>
</html>
